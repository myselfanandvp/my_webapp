<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sales Report</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background-color: #f8fafc;
      color: #1f2937;
    }
    .report-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    table thead {
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .status-badge {
      padding: 4px 12px;
      border-radius: 9999px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .status-delivered { background-color: #16a34a; color: white; }
    .status-pending { background-color: #f59e0b; color: white; }
    .status-other { background-color: #ef4444; color: white; }
  </style>
</head>
<body>
  <div class="report-container">
    <!-- Report Header -->
    <div class="flex items-center justify-between border-b pb-4 mb-6">
      <div>
        <h1 class="text-3xl font-bold text-indigo-700">ðŸ“Š Sales Report</h1>
        <p class="text-sm text-gray-500 mt-1">Generated on {{ generated_date }}</p>
        <p class="text-gray-600 text-sm">
          {% if period %}
            {% if period == 'custom' %}
              Period: {{ from_date }} â†’ {{ to_date }}
            {% else %}
              Period: {{ period|capfirst }}
            {% endif %}
          {% else %}
            Period: All Time
          {% endif %}
        </p>
      </div>
      <div class="text-right">
        <span class="text-xs text-gray-500">Confidential</span>
      </div>
    </div>

    <!-- Sales Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
      <div class="p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-sm border">
        <h2 class="text-sm font-medium text-blue-700">Overall Sales Count</h2>
        <p class="text-3xl font-extrabold text-blue-800 mt-2">{{ transactions.count|default:"0" }}</p>
        <p class="text-xs text-gray-500">Total orders recorded</p>
      </div>
      <div class="p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl shadow-sm border">
        <h2 class="text-sm font-medium text-purple-700">Overall Order Amount</h2>
        <p class="text-3xl font-extrabold text-purple-800 mt-2">&#8377; {{ total_amount|floatformat:2|default:"0.00" }}</p>
        <p class="text-xs text-gray-500">Total value of sales</p>
      </div>
      <div class="p-6 bg-gradient-to-br from-red-50 to-red-100 rounded-xl shadow-sm border">
        <h2 class="text-sm font-medium text-red-700">Overall Discount</h2>
        <p class="text-3xl font-extrabold text-red-800 mt-2">&#8377; {{ discount_amount|floatformat:2|default:"0.00" }}</p>
        <p class="text-xs text-gray-500">Discounts & coupons applied</p>
      </div>
    </div>

    <!-- Transactions Table -->
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">ðŸ“Œ Recent Transactions</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-200 text-sm rounded-lg overflow-hidden">
        <thead class="bg-indigo-600 text-white">
          <tr>
            <th class="px-4 py-3 text-left">SI No</th>
            <th class="px-4 py-3 text-left">Customer</th>
            <th class="px-4 py-3 text-left">Date</th>
            <th class="px-4 py-3 text-left">Amount</th>
            <th class="px-4 py-3 text-left">Discount</th>
            <th class="px-4 py-3 text-left">Payment Method</th>
            <th class="px-4 py-3 text-left">Status</th>
          </tr>
        </thead>
        <tbody>
          {% for transaction in transactions %}
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 py-3 border-b">{{ forloop.counter }}</td>
            <td class="px-4 py-3 border-b font-medium">{{ transaction.user.username|capfirst }}</td>
            <td class="px-4 py-3 border-b text-gray-600">{{ transaction.created_at|date:"Y-m-d H:i" }}</td>
            <td class="px-4 py-3 border-b font-semibold">&#8377; {{ transaction.amount|floatformat:2 }}</td>
            <td class="px-4 py-3 border-b">
              {% if transaction.coupon_tran and transaction.coupon_tran.discount_amount %}
                &#8377;{{ transaction.coupon_tran.discount_amount|floatformat:2 }}
              {% else %}
                <span class="text-gray-400 italic">No Discount</span>
              {% endif %}
            </td>
            <td class="px-4 py-3 border-b">{{ transaction.payment_method|capfirst }}</td>
            <td class="px-4 py-3 border-b">
              {% if transaction.order %}
                <span class="status-badge 
                  {% if transaction.order.status == 'delivered' %}status-delivered
                  {% elif transaction.order.status == 'pending' %}status-pending
                  {% else %}status-other{% endif %}">
                  {{ transaction.order.status|capfirst }}
                </span>
              {% else %}
                <span class="status-badge status-other">Unknown</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center py-6 text-gray-500">No transactions found</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
