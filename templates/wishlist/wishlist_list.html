{% extends 'shared/base.html' %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/heroicons@2.1.5/24/outline/heroicons.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-100 py-8">
    <div class="container max-w-screen mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-8 text-center">My Wishlist</h1>

        {% if wishlist.count > 0 %}
        <div class="bg-white rounded-lg shadow-md overflow-hidden text-center">
            <!-- Desktop Table Header -->
            <div class="hidden md:grid md:grid-cols-12 bg-gray-50 p-4 font-semibold text-gray-700 border-b">
                <div class="col-span-5">Product Name</div>
                <div class="col-span-2">Unit Price</div>
                <div class="col-span-2">Stock Status</div>
                <div class="col-span-2">Action</div>
                <div class="col-span-1"></div>
            </div>

            <!-- Wishlist Items -->
            <div class="divide-y divide-gray-200">
                {% for item in wishlist %}
                <div class="grid grid-cols-1 md:grid-cols-12 items-center p-4 hover:bg-gray-50 transition-colors">
                    <!-- Product Name and Image -->
                    <div class="col-span-1 md:col-span-5 flex items-center gap-4">
                        {%for image in item.product.images.all%}
                        {%if image.is_primary%}
                        <img src="{{ image.image }}" alt="{{ item.product.name }}"
                            class="w-20 h-20 object-cover rounded">
                        {%endif%}
                        {%endfor%}
                        <span class="text-gray-900 font-medium truncate">{{ item.product.name }}</span><span>({{item.color}})</span>
                    </div>


                    <!-- Unit Price -->
                    <div class="col-span-1 md:col-span-2 mt-2 md:mt-0 text-indigo-600 font-bold">
                        &#8377 {{item.product.price }}</div>

                    <!-- Stock Status -->
                    <div class="col-span-1 md:col-span-2 mt-2 md:mt-0">
                        <span
                            class="inline-block px-2 py-1 text-sm font-medium rounded {% if item.product.stock_qty > 0 %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {% if item.product.stock_qty > 0 %}In Stock{% else %}Out of Stock{% endif %}
                        </span>
                    </div>

                    <!-- Add to Cart -->
                    <div class="col-span-1 md:col-span-2 mt-2 md:mt-0">
                        <form method="post" class="addtocart" data-url="{%url 'add_cart_url' item.product.id %}" action="{%url 'add_cart_url' item.product.id %}">

                            {%csrf_token%}
                          
                            <input type="text" name="color" value="{{item.color.id}}" hidden>
                              <button type="submit"
                            class="bg-gray-800 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-900 active:bg-gray-950 transition-colors w-full md:w-auto">
                            Add to Cart
                        </button>
                        </form>
                      
                    </div>

                    <!-- Remove -->

                    <div class="col-span-1 md:col-span-1 mt-2 md:mt-0 text-center">
                        <form method="post" action="{%url 'wishlist_remove_url' item.id %}"
                           >
                            {% csrf_token %}
                            <button type="submit" class="text-red-500">

                                <svg class="w-5 h-5 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                    </path>
                                </svg>
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Wishlist Count -->
        <div class="mt-8 text-center ">
            <p class="text-gray-600 text-base sm:text-lg">Total items in wishlist: <span class="font-bold">{{wishlist.count }}</span></p>
        </div>

        {% else %}
        <div class="text-center py-12">
            <p class="text-gray-600 text-lg sm:text-xl">Your wishlist is empty.</p>
            <a href="{%url 'all_products_url' %}"
                class="mt-4 inline-block bg-indigo-600 text-white px-6 py-3 rounded-md text-sm font-medium hover:bg-indigo-700 active:bg-indigo-800 transition-colors">
                Browse Products
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
  {% if messages %}
  {% for message in messages %}
  Swal.fire({
    icon: '{% if message.tags == "success" %}success{% elif message.tags == "error" %}error{% else %}info{% endif %}',
    title: '{{ message.tags|title }}',
    text: '{{ message|escapejs }}',
    showConfirmButton: false,
    timer: 3000,
    showClass: {
      popup: 'animate__animated animate__fadeIn'
    },
    hideClass: {
      popup: 'animate__animated animate__fadeOut'
    }
  });
  {% endfor %}
  {% endif %}
</script>


<script>
document.querySelectorAll(".addtocart").forEach(element=>{
    element.addEventListener('click',(e)=>{
        e.preventDefault();
        url= element.getAttribute('data-url')
        formData = new FormData(element);

        fetch(url,{
            headers:{
                "X-CSRFToken":'{{csrf_token}}'
            },
            method:"post",
            body:formData
        }).then(response=>response.json()).then(data=>{
              Swal.fire({
                        icon: data.status,
                        text: data.message,
                        showConfirmButton: false,
                        timer: 3000,
                        showClass: {
                            popup: 'animate__animated animate__fadeIn'
                        },
                        hideClass: {
                            popup: 'animate__animated animate__fadeOut'
                        }
                    }); 
            setTimeout(() => {
                if(data.status==="success"){
                 
                    window.location.reload();
                }
            },2000);
        }).catch(error=>{
            console.log(error)
        })
        



    })
})
</script>
{% endblock %}